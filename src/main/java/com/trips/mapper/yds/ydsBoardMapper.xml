<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.trips.mapper.yds.ydsBoardMapper">
<delete id="deleteLikeByLNO">
DELETE FROM ACTI_LIKE WHERE B_NO = #{B_NO} AND M_ID = 'aa'

</delete>

<insert id="plusLike" useGeneratedKeys="true" keyProperty="board.L_NO">
INSERT INTO ACTI_LIKE (
	L_CLICK,
	M_ID,
    B_NO
)
VALUES(1, 'aa', #{num});
	
</insert>

<select id="getBoardList" resultType="com.trips.domain.yds.TripsBoardDto">
SELECT
	b.B_NO num,
	b.B_TITLE title,
	b.M_ID writer,
	b.B_CONTENT content,
	f.B_FILENAME fileName,
	b.B_STATUS,
	b.B_CREATEDATE
FROM ACTI_BOARD b
LEFT JOIN ACTI_FILE f on f.B_NO = b.B_NO
GROUP BY b.B_NO
ORDER BY b.B_NO DESC; 
</select>

<select id="getFiveFiles" resultType="com.trips.domain.yds.TripsBoardDto">
SELECT
	b.B_NO num,
	b.B_TITLE title,
	b.M_ID writer,
	b.B_CONTENT content,
	f.B_FILENAME fileName,
	b.B_STATUS,
	b.B_CREATEDATE createDate,
	b.COST price
FROM ACTI_BOARD b
LEFT JOIN ACTI_FILE f on f.B_NO = b.B_NO
ORDER BY b.B_NO DESC
LIMIT 5; 
</select>

<select id="getBoard" resultMap="boardMap">
SELECT
	b.B_NO num,
	b.B_TITLE title,
	b.M_ID writer,
	b.B_CONTENT content,
	b.B_CREATEDATE createDate,
	b.B_HOSTINTRO hostIntro,
	(SELECT COUNT(*) FROM ACTI_LIKE l WHERE l.B_NO= #{num}) countLike,
	b.COST price,
	f.B_FILENAME fileName 
FROM ACTI_BOARD b
LEFT JOIN ACTI_FILE f ON b.B_NO = f.B_NO
WHERE b.B_NO = #{num}
</select>

<resultMap type="com.trips.domain.yds.TripsBoardDto" id="boardMap">
		<result column="num" property="num"></result>
		<result column="title" property="title"/>
		<result column="writer" property="writer"></result>
		<result column="content" property="content"/>
		<result column="createDate" property="createDate"/>
		<result column="hostIntro" property="hostIntro"></result>
		<result column="countLike" property="countLike"/>
		<result column="price" property="price"/>
		<collection property="fileName" ofType="string">
			<result property="fileName" column="fileName"/>
		</collection>
</resultMap>

<delete id="removeBoard">
DELETE FROM ACTI_BOARD
WHERE B_NO = #{num}
</delete>

<select id="getLikeByBNO" resultType="int">
SELECT COUNT(*) FROM ACTI_LIKE WHERE B_NO= #{num}

</select>

<update id="modifyBoard">
UPDATE ACTI_BOARD b
SET
	b.B_TITLE = #{title},
	b.B_CONTENT = #{content},
	b.COST = #{price},
	b.B_HOSTINTRO = #{hostIntro}
WHERE b.B_NO = #{num}
</update>

<delete id="deleteFileByNumAndfileName">
DELETE FROM ACTI_FILE 
WHERE B_NO = #{num} AND B_FILENAME = #{fileName} 

</delete>

<insert id="insertFile">
	INSERT INTO ACTI_FILE (B_NO, B_FILENAME)
	VALUES (#{num}, #{fileName})
</insert>
</mapper>